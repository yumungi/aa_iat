<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Alopecia IAT</title>
  <!-- jsPsych CSS (browser-ready bundle via jsDelivr) -->
  <link
    href="https://cdn.jsdelivr.net/npm/jspsych@7.3.0/dist/css/jspsych.css"
    rel="stylesheet"
    type="text/css"
  />
</head>
<body></body>

<!-- jsPsych core & plugins (browser-ready bundles via jsDelivr) -->
<script src="https://cdn.jsdelivr.net/npm/jspsych@7.3.0/dist/jspsych.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspsych@7.3.0/dist/plugins/jspsych-html-button-response.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspsych@7.3.0/dist/plugins/jspsych-html-keyboard-response.js"></script>
<!-- Hammer.js for swipe detection -->
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>

<script>
(async function(){
  // Initialize
  const jsPsych = initJsPsych();

  // Google Apps Script endpoint
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw1KZCy_46ZFKajTjZdYH4hRr3Gz0moetyIeYpCBQRe8s15UMrwt3znAsmhzomfN8D7/exec";

  // Stimuli
  const alopeciaImages = Array.from({length:5},(_,i)=>`alopecia-${i+1}.jpg`);
  const hairImages    = Array.from({length:5},(_,i)=>`hair-${i+1}.jpg`);
  const goodWords     = ["Friend","Together","Trusted","Familiar","Safe","Accepted","Family","Included"];
  const badWords      = ["Stranger","Isolated","Weird","Rejected","Different","Excluded","Awkward","Them"];

  // Helpers to build trials
  const makeImageTrials = (arr,correct) =>
    arr.map(fn=>({stimulus:`<img src="${fn}" style="max-width:80vw;max-height:60vh;">`, correct}));
  const makeWordTrials  = (arr,correct) =>
    arr.map(w=>({stimulus:`<p style="font-size:2em;">${w}</p>`, correct}));
  function repeat(arr,times){ return Array(times).fill(arr).flat(); }

  // Build each block’s trials
  const block1Trials = jsPsych.randomization.shuffle(
    repeat(
      makeImageTrials(alopeciaImages,'left')
      .concat(makeImageTrials(hairImages,'right')),
    2)
  );
  const block2Trials = jsPsych.randomization.shuffle(
    makeWordTrials(goodWords,'left').concat(makeWordTrials(badWords,'right'))
  );
  const block3Trials = jsPsych.randomization.shuffle(
    makeImageTrials(alopeciaImages,'left')
      .concat(makeImageTrials(hairImages,'right'))
      .concat(makeWordTrials(goodWords,'left'))
      .concat(makeWordTrials(badWords,'right'))
  );
  const block4Trials = jsPsych.randomization.shuffle(repeat(block3Trials,2));
  const block5Trials = jsPsych.randomization.shuffle(
    repeat(
      makeImageTrials(hairImages,'left')
      .concat(makeImageTrials(alopeciaImages,'right')),
    2)
  );
  const block6Trials = jsPsych.randomization.shuffle(
    makeImageTrials(hairImages,'left')
      .concat(makeImageTrials(alopeciaImages,'right'))
      .concat(makeWordTrials(goodWords,'left'))
      .concat(makeWordTrials(badWords,'right'))
  );
  const block7Trials = jsPsych.randomization.shuffle(repeat(block6Trials,2));

  // 1. Consent screen
  jsPsych.timeline.push({
    type: 'html-button-response',
    stimulus: `
      <h2>Welcome</h2>
      <p>This test measures unconscious bias toward people with alopecia areata.</p>
      <p>Swipe <strong>left</strong> or <strong>right</strong> to categorise each item.</p>
      <p>Click “I consent” to begin.</p>`,
    choices: ['

