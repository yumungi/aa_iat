<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Survey IAT</title>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; padding: 0; font-family: Arial, sans-serif; background: #f0f2f5; color: #333; overflow: hidden; }
    /* Loading overlay */
    #loading {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      display: flex; align-items: center; justify-content: center;
      background: #fff; z-index: 1000; font-size: 1.5em;
    }
    /* Screens */
    .screen { display: none; width: 100vw; height: 100vh; padding: 2em; display: flex;
               flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    .active { display: flex; }
    .btn { padding: 0.8em 1.5em; margin: 0.5em; font-size: 1em; background: #007bff;
           color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    .btn:disabled { background: #aaa; cursor: not-allowed; }
    #label-container { width: 100%; display: flex; justify-content: space-between;
                       padding: 0 2em; font-size: 1.2em; margin-bottom: 0.5em; }
    #label-container span { font-weight: bold; }
    #img-container { position: relative; flex: 1; width: 100%; display: flex;
                     align-items: center; justify-content: center; }
    #img-container img { max-width: 80%; max-height: 70%; border: 2px solid #ccc;
                         border-radius: 8px; touch-action: none; transition: transform 0.3s ease;
                         position: absolute; background: #fff; }
    #results { width: 90%; max-height: 70%; overflow-y: auto; margin-top: 1em; text-align: left; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; }
    th { background: #e9ecef; }
  </style>
</head>
<body>
  <!-- Loading screen -->
  <div id="loading">Loading images, please wait...</div>

  <!-- Page 1: Consent & Demographics -->
  <div id="page1" class="screen">
    <h2>Consent & Demographics</h2>
    <p>Please provide consent and basic demographics to begin.</p>
    <label><input type="checkbox" id="consentCB"> I consent to participate</label>
    <div><label>Sex: <select id="sexSel"><option value="">--Select--</option><option>Female</option><option>Male</option><option>Other</option></select></label></div>
    <div><label>Age: <input type="number" id="ageInp" min="18" max="120" placeholder="Enter age"></label></div>
    <button id="next1" class="btn" disabled>Next</button>
  </div>

  <!-- Page 2: Instructions -->
  <div id="page2" class="screen">
    <h2>Instructions</h2>
    <p>You will see a question and a series of images.</p>
    <p>Swipe <strong>right</strong> if you agree and <strong>left</strong> if you disagree.</p>
    <p>Your response time mattersâ€”swipe as quickly as possible based on your initial reaction.</p>
    <p>Your answers are anonymous.</p>
    <button id="next2" class="btn">Start Survey</button>
  </div>

  <!-- Page 3: Question Prompt -->
  <div id="page3" class="screen">
    <h2>Question</h2>
    <p id="questionText">Would you hire this person?</p>
    <button id="startBtn" class="btn">Begin</button>
  </div>

  <!-- Page 4: Swipe Section -->
  <div id="page4" class="screen">
    <div id="label-container"><span>No</span><span>Yes</span></div>
    <div id="img-container"></div>
  </div>

  <!-- Page 5: Thank you & Results -->
  <div id="page5" class="screen">
    <h2>Thank you for participating!</h2>
    <div id="results"></div>
  </div>

  <!-- Hammer.js -->
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
  <script>
    // Page array and show function
    const pages = ['page1','page2','page3','page4','page5'];
    function showPage(id) {
      pages.forEach(p => document.getElementById(p).classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // Preload images with loading screen
    const images = [
      'alopecia-1.jpg','alopecia-2.jpg','alopecia-3.jpg','alopecia-4.jpg','alopecia-5.jpg',
      'hair-1.jpg','hair-2.jpg','hair-3.jpg','hair-4.jpg','hair-5.jpg'
    ];
    let loadedImages = 0;
    images.forEach(src => {
      const img = new Image(); img.src = src;
      img.onload = () => {
        loadedImages++;
        if (loadedImages === images.length) {
          document.getElementById('loading').style.display = 'none';
          initSurvey();
        }
      };
    });

    // Survey logic
    function initSurvey() {
      showPage('page1');
      // Page1 controls
      const consentCB = document.getElementById('consentCB');
      const sexSel = document.getElementById('sexSel');
      const ageInp = document.getElementById('ageInp');
      const next1 = document.getElementById('next1');
      function check1() {
        next1.disabled = !(consentCB.checked && sexSel.value && ageInp.value);
      }
      [consentCB, sexSel, ageInp].forEach(el => el.addEventListener('input', check1));
      next1.addEventListener('click', () => showPage('page2'));

      document.getElementById('next2').addEventListener('click', () => showPage('page3'));

      document.getElementById('startBtn').addEventListener('click', () => {
        showPage('page4');
        startExperiment();
      });
    }

    // Experiment logic
    let idx = 0, responses = [], startTime;
    let currentImg, hammer;

    function startExperiment() {
      idx = 0; responses = [];
      loadNext();
    }

    function createImage(src) {
      const img = new Image(); img.src = src; img.draggable = false;
      img.style.position = 'absolute'; img.style.transition = 'transform 0.3s ease';
      img.style.transform = 'translateX(0) rotate(0)'; return img;
    }

    function bindSwipe(el) {
      hammer = new Hammer(el);
      hammer.get('pan').set({ direction: Hammer.DIRECTION_HORIZONTAL, threshold: 10 });
      hammer.on('panmove', e => {
        el.style.transition = 'none';
        el.style.transform = `translateX(${e.deltaX}px) rotate(${e.deltaX/20}deg)`;
      });
      hammer.on('panend', e => {
        const dt = Date.now() - startTime;
        const dir = e.deltaX > 0 ? 'yes' : 'no';
        if (Math.abs(e.deltaX) > 100) {
          el.style.transition = 'transform 0.3s ease';
          const off = dir==='yes' ? window.innerWidth : -window.innerWidth;
          el.style.transform = `translateX(${off}px) rotate(${dir==='yes'?45:-45}deg)`;
          responses.push({
            sex: document.getElementById('sexSel').value,
            age: document.getElementById('ageInp').value,
            image: images[idx], response: dir, rt: dt
          });
          setTimeout(() => { idx++; loadNext(); }, 300);
        } else {
          el.style.transition = 'transform 0.2s ease';
          el.style.transform = 'translateX(0) rotate(0)';
        }
      });
    }

    function loadNext() {
      const container = document.getElementById('img-container');
      if (currentImg) { hammer.destroy(); container.removeChild(currentImg); }
      if (idx >= images.length) { showPage('page5'); renderResults(); return; }
      currentImg = createImage(images[idx]);
      container.appendChild(currentImg);
      bindSwipe(currentImg);
      startTime = Date.now();
    }

    function renderResults() {
      const resDiv = document.getElementById('results');
      resDiv.innerHTML = `<p><strong>Sex:</strong> ${document.getElementById('sexSel').value} | <strong>Age:</strong> ${document.getElementById('ageInp').value}</p>`;
      const tbl = document.createElement('table');
      const hdr = tbl.insertRow(); ['Image','Response','RT (ms)'].forEach(t => { const th = document.createElement('th'); th.textContent = t; hdr.appendChild(th); });
      responses.forEach(r => {
        const row = tbl.insertRow(); [r.image, r.response, r.rt].forEach(v => { const c = row.insertCell(); c.textContent = v; });
      });
      resDiv.appendChild(tbl);
    }
  </script>
</body>
</html>

