<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Survey IAT</title>
  <style>
    body { margin:0; padding:0; font-family: Arial, sans-serif; background: #f0f2f5; color: #333; overflow: hidden; }
    /* Loading overlay */
    #loading {
      position: fixed; top:0; left:0; width:100vw; height:100vh;
      display: flex; align-items: center; justify-content: center;
      background: #fff; z-index: 1000; font-size: 1.5em;
    }
    .screen { display: none; width: 100vw; height: 100vh; align-items: center;
               justify-content: center; flex-direction: column; padding: 2em; box-sizing: border-box; }
    .active { display: flex; }
    .btn { padding: 0.8em 1.5em; margin: 0.5em; font-size: 1em;
           background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .btn:disabled { background: #aaa; cursor: not-allowed; }
    h2 { margin-bottom: 0.5em; }
    #label-container { width:100%; display:flex; justify-content:space-between;
                       padding: 0 2em; font-size:1.2em; margin-bottom:0.5em; }
    #label-container span { font-weight:bold; }
    #img-container { position:relative; flex:1; display:flex; align-items:center;
                     justify-content:center; width:100%; }
    #img-container img { max-width:80%; max-height:70%; border:2px solid #ccc;
                         border-radius:8px; touch-action:none; transition:transform 0.3s ease;
                         position:absolute; background:white; }
    #results { width:90%; max-height:70%; overflow-y:auto; margin-top:1em; text-align:left; }
    table { width:100%; border-collapse:collapse; margin-bottom:1em; }
    th, td { border:1px solid #ccc; padding:0.5em; }
    th { background:#e9ecef; }
  </style>
</head>
<body>
  <!-- Loading overlay -->
  <div id="loading">Loading images, please wait...</div>

  <!-- Page 1: Consent, sex, age -->
  <div id="page1" class="screen">
    <h2>Consent & Demographics</h2>
    <p>Please provide consent and basic demographics to begin.</p>
    <label><input type="checkbox" id="consentCheckbox"> I consent to participate</label>
    <div style="margin-top:1em;"><label>Sex: <select id="sexSelect"><option value="">--Select--</option><option>Female</option><option>Male</option><option>Other</option></select></label></div>
    <div style="margin-top:1em;"><label>Age: <input type="number" id="ageInput" min="18" max="120" placeholder="Enter age"></label></div>
    <button id="toPage2" class="btn" disabled>Next</button>
  </div>

  <!-- Page 2: Information -->
  <div id="page2" class="screen">
    <h2>Instructions</h2>
    <p>You will see a question and a series of images.</p>
    <p>Swipe <strong>right</strong> if you agree and <strong>left</strong> if you disagree.</p>
    <p>Your response time matters—swipe as quickly as possible based on your initial “gut” reaction.</p>
    <p>Your answers are anonymous.</p>
    <button id="toPage3" class="btn">Start Survey</button>
  </div>

  <!-- Page 3: Question -->
  <div id="page3" class="screen">
    <h2>Question</h2>
    <div id="question" style="font-size:1.5em; text-align:center; margin-bottom:1em;">Would you hire this person?</div>
    <button id="toPage4" class="btn">Begin</button>
  </div>

  <!-- Page 4: Images -->
  <div id="page4" class="screen">
    <div id="label-container">
      <span>No</span><span>Yes</span>
    </div>
    <div id="img-container"></div>
  </div>

  <!-- Page 5: Question 2 -->
  <div id="page5" class="screen">
    <h2>Question 2</h2>
    <div id="question2" style="font-size:1.5em; text-align:center; margin-bottom:1em;">Would you recommend this product?</div>
    <button id="toPage6" class="btn">Begin Round 2</button>
  </div>

  <!-- Page 6: Images 2 -->
  <div id="page6" class="screen">
    <div id="label-container">
      <span>Dislike</span><span>Like</span>
    </div>
    <div id="img-container"></div>
  </div>

  <!-- Page 7: Thank you & Results -->
  <div id="page7" class="screen">
    <h2>Thank you for participating!</h2>
    <div id="results"></div>
  </div>

  <!-- Hammer.js for swipe -->
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
  <script>
    const images = ['alopecia-1.jpg','alopecia-2.jpg','alopecia-3.jpg','alopecia-4.jpg','alopecia-5.jpg',
                    'hair-1.jpg','hair-2.jpg','hair-3.jpg','hair-4.jpg','hair-5.jpg'];
    const imagesRound2 = ['alopecia-1.jpg','alopecia-2.jpg','alopecia-3.jpg','alopecia-4.jpg','alopecia-5.jpg', 
                         'hair-1.jpg','hair-2.jpg','hair-3.jpg','hair-4.jpg','hair-5.jpg'];
    let loadedImages = 0, idx = 0, responses = [], startTime, currentImg, hamm;

    // Preload images
    [...images, ...imagesRound2].forEach(src => {
      const img = new Image(); img.src = src;
      img.onload = () => { loadedImages++; if (loadedImages === (images.length + imagesRound2.length)) initSurvey(); };
    });

    const pages = ['page1', 'page2', 'page3', 'page4', 'page5', 'page6', 'page7'];
    function showPage(i) { pages.forEach((id, idx) => document.getElementById(id).classList.toggle('active', idx === i)); }

    function initSurvey() {
      showPage(0);
      document.getElementById('toPage2').addEventListener('click', () => showPage(1));
      document.getElementById('toPage3').addEventListener('click', () => showPage(2));
      document.getElementById('toPage4').addEventListener('click', () => { showPage(3); startExperiment(images, 'page5'); });
      document.getElementById('toPage6').addEventListener('click', () => { showPage(5); startExperiment(imagesRound2, 'page7'); });
    }

    function startExperiment(imageSet, nextPage) {
      idx = 0; responses = []; loadNext(imageSet, nextPage);
    }

    function loadNext(imageSet, nextPage) {
      const container = document.getElementById('img-container');
      if (currentImg) { hamm.destroy(); container.removeChild(currentImg); }
      if (idx >= imageSet.length) { showPage(pages.indexOf(nextPage)); renderResults(); return; }
      currentImg = createImage(imageSet[idx]);
      container.appendChild(currentImg);
      bindSwipe(currentImg, imageSet, nextPage);
      startTime = Date.now();
    }

    function createImage(src) {
      const img = new Image(); img.src = src; img.draggable = false;
      img.style.position = 'absolute'; img.style.transition = 'transform 0.3s ease';
      img.style.transform = 'translateX(0) rotate(0)'; return img;
    }

    function bindSwipe(el, imageSet, nextPage) {
      hamm = new Hammer(el);
      hamm.get('pan').set({ direction: Hammer.DIRECTION_HORIZONTAL, threshold: 10 });
      hamm.on('panmove', e => { el.style.transition = 'none'; el.style.transform = `translateX(${e.deltaX}px) rotate(${e.deltaX / 20}deg)`; });
      hamm.on('panend', e => {
        const dt = Date.now() - startTime;
        const dir = e.deltaX > 0 ? 'yes' : 'no';
        if (Math.abs(e.deltaX) > 100) {
          el.style.transition = 'transform 0.3s ease';
          el.style.transform = `translateX(${dir === 'yes' ? window.innerWidth : -window.innerWidth}px) rotate(${dir === 'yes' ? 45 : -45}deg)`;
          responses.push({ image: imageSet[idx], response: dir, rt: dt });
          setTimeout(() => { idx++; loadNext(imageSet, nextPage); }, 300);
        } else { el.style.transition = 'transform 0.2s ease'; el.style.transform = 'translateX(0) rotate(0)'; }
      });
    }

    function renderResults() {
      const resDiv = document.getElementById('results');
      resDiv.innerHTML = '<h3>Survey Results</h3>';
      const tbl = document.createElement('table');
      const hdr = tbl.insertRow(); ['Image', 'Response', 'RT (ms)'].forEach(t => { const th = document.createElement('th'); th.textContent = t; hdr.appendChild(th); });
      responses.forEach(r => { const row = tbl.insertRow(); [r.image, r.response, r.rt].forEach(v => { const c = row.insertCell(); c.textContent = v; }); });
      resDiv.appendChild(tbl);
    }
  </script>
</body>
</html>
